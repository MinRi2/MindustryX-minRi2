From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Tue, 27 Aug 2024 17:34:34 +0800
Subject: [PATCH] =?UTF-8?q?WIP=20=E6=95=B4=E7=90=86=E8=AE=BE=E7=BD=AE?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 core/assets/bundles/bundle-mdtx.properties    | 68 +++++++---------
 .../mindustry/ui/fragments/HudFragment.java   |  2 +-
 core/src/mindustryX/features/ArcOld.java      | 80 +++----------------
 core/src/mindustryX/features/Settings.java    | 47 +++++++++--
 .../features/ui/ArcWaveInfoDialog.java        |  3 +-
 5 files changed, 81 insertions(+), 119 deletions(-)

diff --git a/core/assets/bundles/bundle-mdtx.properties b/core/assets/bundles/bundle-mdtx.properties
index 935b1f1cbeeff82fe9d1a6f4f8ee18a9e39e0a39..08e9e2eef3c2062010849d39659988b4fd05d260 100644
--- a/core/assets/bundles/bundle-mdtx.properties
+++ b/core/assets/bundles/bundle-mdtx.properties
@@ -61,22 +61,36 @@ stat.ammo_capacity = 子弹容量
 #end StatExt
 
 # Settings
-settings.category.mindustryX = MindustryX扩展
+settings.category.mindustryX = [gold]MindustryX
 setting.showUpdateDialog.name = 检测到新版MindustryX时提示
 setting.githubMirror.name = GitHub镜像加速(WZ镜像)    [gray]优化全球服务器列表及Mod浏览器功能
-
-category.gameSettings.name = 游戏界面或操作
-setting.deadOverlay.name = 死亡时(观战)显示界面
-setting.invertMapClick.name = 反转小地图的左右键点击
-
-category.arcReWork.name = Arc功能重置
 setting.replayRecord.name = 多人游戏录像    [gray]自动录制游玩过程，输出在saves文件夹
-setting.menuFloatText.name = 首页悬浮文字
 setting.researchViewer.name = 科技树透视器
+
+category.gameUI.name = 游戏界面扩展
+setting.menuFloatText.name = 首页悬浮文字
+setting.deadOverlay.name = 死亡时(观战)仍然显示界面
+setting.invertMapClick.name = 反转小地图的左右键点击
+setting.arcSpecificTable.name = 学术信息显示(左上角)     [orange][重启生效]
+setting.logicSupport.name = 逻辑辅助器
+setting.powerStatistic.name = 电量统计     [orange][重启生效]
+setting.showQuickToolTable.name = 快捷工具(右中部)    [gray]快捷设置/工具箱/建筑工具
+setting.AuxiliaryTable.name = 辅助器     [orange][重启生效]
+setting.arccoreitems.name = 核心物资显示   [gray]点击电量条可快捷切换
+setting.arcCoreItemsCol.name = 核心物资显示列数
+setting.itemSelectionHeight.name = 建筑选择框(右下角)行数
+setting.itemSelectionWidth.name = 建筑选择框(右下角)列数
+setting.blockInventoryWidth.name = 建筑物品栏(分类器)每行物品数
+setting.editorBrush.name = 编辑器界面每行建筑数
 setting.minimapSize.name = 小地图大小
-setting.maxSchematicSize.name = 最大蓝图大小
+setting.maxSchematicSize.name = 最大选择框(蓝图)大小
+setting.colorizedContent.name = [orange]彩[yellow]色[acid]属[cyan]性[violet]包
+setting.arcBackgroundPath.name = 首页自定义背景-路径
+setting.autoSelSchematic.name = 蓝图自动选择      [gray]打开蓝图时自动筛选
+setting.arcCommandTable.name = RTS扩展按钮
 
 category.blockSettings.name = 建筑相关设置
+setting.rotateCanvas.name = 蓝图旋转时会旋转画板内容 [orange]可能导致崩溃，小心使用
 setting.staticShieldsBorder.name = 静止力墙边界
 setting.arcTurretPlaceCheck.name = [pink]炮台[white]：范围检查
 setting.arcchoiceuiIcon.name = [acid]装卸|分类[white]：显示物品图标
@@ -91,10 +105,13 @@ setting.bulletShow.name = 显示子弹
 setting.showminebeam.name = 显示单位挖掘光束
 setting.noPlayerHitBox.name = 取消玩家自身的碰撞 [gray]轻微作弊
 setting.payloadpreview.name = 载荷单位拾起预览
+setting.unithitbox.name = 显示单位碰撞箱
 
 category.developerMode.name = 特殊设置
 setting.renderMerge.name = 顶点合并渲染 [grey]实验性功能，可以减少Draws总数
 setting.renderSort.name = 渲染排序 [grey]多图集(Mod较多)情况下能够提升50%渲染性能，但可能造成渲染错误
+setting.limitupdate.name = 限制更新
+setting.limitdst.name = 限制更新-额外范围
 #end Settings
 
 # editor增强
@@ -367,76 +384,49 @@ rules.title.arcExperimental = 隐藏设置[red](实验性功能，可能影响
 rules.unitPayloadUpdate = [acid]单位携带的方块会工作
 rules.winWave = [acid]胜利波次  [gray](到达指定波次后自动停止)
 schematic.preview = 预览
-setting.AuxiliaryTable.name = [acid]辅助器     [orange][重启生效]
 setting.ShowInfoPopup.name = [acid]服务器信息版
 setting.allUnlocked.name = [cyan]显示所有内容(含隐藏)
 setting.alwaysShowPlayerUnit.name = [cyan]强制显示[white]:玩家本体及带领的单位
 setting.alwaysShowUnitRTSAi.name = [acid]单位[white]：执行的RTS命令
 setting.alwaysshowdropzone.name = [cyan]刷怪点
 setting.arcAlwaysTeamColor.name = [acid]玩家列表[white]：总是绘制队伍颜色
-setting.arcBackgroundPath.name = [cyan]首页背景路径
 setting.arcBuildInfo.name = [cyan]建造范围
-setting.arcCommandTable.name = [acid]RTS辅助器     [lightgray]替代原版
-setting.arcCoreItemsCol.name = [acid]arc核心物资列数
-setting.arcDisableModWarning.name = [orange]我已知晓且同意学术端的mod使用原则
 setting.arcDrillProgress.name = [acid]钻头[white]：显示挖掘进度      [gray]只推荐mod下使用
 setting.arcSelfName.name = [acid]显示自身名字
 setting.arcShareWaveInfo.name = [acid]游戏信息交流[gray](标记物品)  [red]请勿刷屏
-setting.arcSpecificTable.name = [acid]学术端特制界面     [orange][重启生效]
 setting.arcTurretPlacementItem.name = [pink]炮台[white]：弹药射界
-setting.arccoreitems.name = [acid]arc核心物资   [gray]点击电量条
 setting.arcdrillmode.name = [acid]钻头[white]：常亮矿物
 setting.arclogicbordershow.name = [acid]显示屏与画板[white]：边框       [gray]关闭后多个显示屏会更好得拼接在一起
-setting.arcvol.name = [acid]音量[white]：学术音效
-setting.autoSelSchematic.name = [cyan]蓝图自动选择器      [orange]自动筛选包含选中物品的蓝图
 setting.blockBars.name = [acid]建筑属性
 setting.blockBars_mend.name = [acid]修复[white]：进度条
-setting.blockInventoryWidth.name = [cyan]建筑物品栏每行物品数
 setting.blockWeaponTargetLine.name = [acid]炮台[white]：瞄准线
 setting.blockWeaponTargetLineWhenIdle.name = [acid]炮台[white]：瞄准线（闲置）
 setting.blockdisabled.name = [cyan]建筑禁用显示
 setting.chatValidType.name = [acid]聊天记录
-setting.colorizedContent.name = [orange]彩[yellow]色[acid]属[cyan]性[violet]包
-setting.developMode.name = [red]开发者模式  [orange]不完善|测试中的功能，普通用户请不要打开。欢迎提出修复方案
 setting.displayblock.name = [cyan]工厂方块
-setting.editorBrush.name = [acid]编辑器[white]：每行建筑数
 setting.fontSet.name = [cyan]字体设置！
 setting.fontSize.name = [cyan]字体大小！
 setting.forceConfigInventory.name = [acid]功能[white]：强制拿取资源
 setting.forceEnableDarkness.name = [cyan]墙体阴影显示
 setting.forceIgnoreAttack.name = [violet]战役[white]：忽视遭受攻击警告强行切换区块
 setting.hoveredTileInfo.name = [acid]显示鼠标指针地块/建筑名称
-setting.itemSelectionHeight.name = [cyan]建筑选择框行数
-setting.itemSelectionWidth.name = [cyan]建筑选择框列数
-setting.limitdst.name = [cyan]视角外更新范围
-setting.limitupdate.name = [cyan]限制更新
-setting.logicSupport.name = [acid]逻辑辅助器
 setting.logicoverrangelink.name = [red]超级逻辑链接     [yellow][仅限单机有效]
 setting.mass_driver_line.name = 显示质驱引导线
 setting.mass_driver_line_color.name = [pink]质驱引导线[white]：颜色
 setting.mass_driver_line_interval.name = [acid]质驱引导线[white]：箭头间隔
 setting.mend_zone.name = [acid]修复范围[white]：不透明度
-setting.oneBlockProperty.name = [acid]复制单个建筑时展示属性       [orange]无需要不建议开启，会导致属性丢失
-setting.otherCheat.name = [red]其他作弊功能(游戏外)
 setting.overrideSkipWave.name = [acid]功能[white]：忽视跳波限制
-setting.override_boss_shown.name = [cyan]boss血条
-setting.overridebuild.name = [cyan]强制覆盖建筑与墙体      [yellow][仅限单机有效]
 setting.playerEffectColor.name = [acid]玩家射程[white]：颜色
 setting.playerEffectCurStroke.name = [acid]玩家射程[white]：粗细
 setting.playerNeedShooting.name = [red]时间管理大师
-setting.powerStatistic.name = [acid]电量统计     [orange][重启生效]
-setting.quickHudSize.name = [acid]快捷视角    [gray]快捷切换视角，屏幕下侧
 setting.radarMode.name = [acid]雷达模式
 setting.radarSize.name = [acid]雷达大小
-setting.rotateCanvas.name = 蓝图旋转时会旋转画板内容 [orange]可能导致崩溃，小心使用
 setting.rtsWoundUnit.name = [acid]单位筛选[white]：残血阈值
 setting.save_more_map.name = [acid]保存战役与编辑器地图
-setting.selectTeam.name = [acid]显示[white]：[red]选择队伍框    [yellow][仅限单机有效]
 setting.showFlyerSpawn.name = [cyan]空军刷怪点
 setting.showFlyerSpawnLine.name = [cyan]空军刷怪点连线
 setting.showOtherTeamResource.name = [acid]显示[white]：[red]所有队伍资源     [orange][PVP自动禁用]
 setting.showOtherTeamState.name = [acid]显示[white]：[red]其他并可修改队伍状态  [orange][PVP自动禁用][yellow][修改仅限单机有效]
-setting.showQuickToolTable.name = [acid]快捷工具    [gray]快捷聊天/设置与建筑相关
 setting.showTurretAmmo.name = [acid]炮台[white]：子弹类型
 setting.showTurretAmmoAmount.name = [acid]炮台[white]：子弹数量
 setting.superUnitEffect.name = [pink]玩家特效射程
@@ -455,13 +445,9 @@ setting.unitWeaponRange.name = [acid]单位武器射程[white]：范围警告
 setting.unitWeaponRangeAlpha.name = [acid]单位武器射程[white]：不透明度
 setting.unitWeaponTargetLine.name = [acid]单位武器目标
 setting.unitbuildplan.name = [acid]单位[white]：建造序列显示
-setting.unithitbox.name = [acid]单位碰撞箱
 setting.worldCreator.name = [cyan]创世神   [gray]无视限制，可编辑地形
-settings.arc = [cyan]学术端！
-settings.cheating = [red]作弊功能
-settings.forcehide = [orange]帧率重调装置
+settings.arc = [cyan]学术端功能
 settings.maxMsgRecorded.name = 最大聊天记录数
-settings.specmode = [acid]更多内容适配
 shield.phaseboost = [stat]+{0}[lightgray] 格 [stat]+{1}[] 护盾容量
 shield.regenspeed = [stat]{0}[lightgray]x 回复速度
 team.neoplastic.name = 瘤
diff --git a/core/src/mindustry/ui/fragments/HudFragment.java b/core/src/mindustry/ui/fragments/HudFragment.java
index 729c0540440f9e5f632a5173b90740eb6163ae85..f6439cf1961be9380ff63fd2db8417759a209a5b 100644
--- a/core/src/mindustry/ui/fragments/HudFragment.java
+++ b/core/src/mindustry/ui/fragments/HudFragment.java
@@ -410,7 +410,7 @@ public class HudFragment{
                 }
                 return max == 0f ? 0f : val / max;
             }).blink(Color.white).outline(new Color(0, 0, 0, 0.6f), 7f)).grow())
-            .fillX().width(320f).height(60f).name("boss").visible(() -> Core.settings.getBool("override_boss_shown") && state.rules.waves && state.boss() != null && !(mobile && Core.graphics.isPortrait())).padTop(7).row();
+            .fillX().width(320f).height(60f).name("boss").visible(() -> state.rules.waves && state.boss() != null && !(mobile && Core.graphics.isPortrait())).padTop(7).row();
 
             t.table(Styles.black3, p -> p.margin(4).label(() -> hudText).style(Styles.outlineLabel)).touchable(Touchable.disabled).with(p -> p.visible(() -> {
                 p.color.a = Mathf.lerpDelta(p.color.a, Mathf.num(showHudText), 0.2f);
diff --git a/core/src/mindustryX/features/ArcOld.java b/core/src/mindustryX/features/ArcOld.java
index 98fa331ff11da0821e4ca81f61a37fefe60b2da2..e68276143705ed1be54e6bccac6ff2c19e2e6bd8 100644
--- a/core/src/mindustryX/features/ArcOld.java
+++ b/core/src/mindustryX/features/ArcOld.java
@@ -20,26 +20,6 @@ import static mindustry.Vars.*;
 public class ArcOld{
     public static void init(Seq<LazySettingsCategory> categories){
         categories.add(new LazySettingsCategory("@settings.arc", () -> Icon.star, (c) -> {
-            c.addCategory("arcHudToolbox");
-            c.sliderPref("AuxiliaryTable", 0, 0, 3, 1, s -> switch(s){
-                case 0 -> "关闭";
-                case 1 -> "左上-右";
-                case 2 -> "左上-下";
-                case 3 -> "右上-下";
-                default -> "";
-            });
-            c.checkPref("arcSpecificTable", true);
-            c.checkPref("logicSupport", true);
-            c.checkPref("powerStatistic", true);
-            c.sliderPref("arccoreitems", 3, 0, 3, 1, s -> switch(s){
-                case 0 -> "不显示";
-                case 1 -> "资源状态";
-                case 2 -> "兵种状态";
-                default -> "显示资源和兵种";
-            });
-            c.sliderPref("arcCoreItemsCol", 5, 4, 15, 1, i -> i + "列");
-            c.checkPref("showQuickToolTable", true);
-
             c.addCategory("arcCgameview");
             c.checkPref("hoveredTileInfo", false);
             c.checkPref("alwaysshowdropzone", false);
@@ -51,11 +31,6 @@ public class ArcOld{
             }
 
             c.addCategory("arcCDisplayBlock");
-            c.sliderPref("blockRenderLevel", 2, 0, 2, 1, s -> switch(s){
-                case 0 -> "隐藏全部建筑";
-                case 1 -> "只显示建筑状态";
-                default -> "全部显示";
-            });
             c.checkPref("forceEnableDarkness", true, (b) -> enableDarkness = b);
             enableDarkness = settings.getBool("forceEnableDarkness");
             c.sliderPref("HiddleItemTransparency", 0, 0, 100, 2, i -> i > 0 ? i + "%" : "关闭");
@@ -174,34 +149,6 @@ public class ArcOld{
             c.checkPref("arcAlwaysTeamColor", false);
             c.checkPref("arcSelfName", false);
 
-            c.addCategory("arcWeakCheat");
-            c.checkPref("save_more_map", false);
-            c.checkPref("forceIgnoreAttack", false);
-            c.checkPref("allUnlocked", false);
-            c.checkPref("worldCreator", false);
-            c.checkPref("overrideSkipWave", false);
-            c.checkPref("forceConfigInventory", false);
-            c.addCategory("arcStrongCheat");
-            c.checkPref("showOtherTeamResource", false);
-            c.checkPref("showOtherTeamState", false);
-            c.checkPref("playerNeedShooting", false);
-        }));
-        categories.add(new LazySettingsCategory("@settings.specmode", () -> Icon.info, (c) -> {
-            c.addCategory("moreContent");
-            c.checkPref("override_boss_shown", false);
-            c.sliderPref("minimapSize", 140, 40, 400, 10, i -> i + "");
-            c.sliderPref("maxSchematicSize", 64, 64, 257, 1, v -> {
-                maxSchematicSize = v == 257 ? Integer.MAX_VALUE : v;
-                return v == 257 ? "无限" : String.valueOf(v);
-            });
-            c.sliderPref("itemSelectionHeight", 4, 4, 12, i -> i + "行");
-            c.sliderPref("itemSelectionWidth", 4, 4, 12, i -> i + "列");
-            c.sliderPref("blockInventoryWidth", 3, 3, 16, i -> i + "");
-            c.sliderPref("editorBrush", 4, 3, 12, i -> i + "");
-            c.checkPref("autoSelSchematic", false);
-            c.checkPref("researchViewer", false);
-
-
             c.addCategory("arcRadar");
             c.sliderPref("radarMode", 0, 0, 30, 1, s -> switch(s){
                 case 0 -> "关闭";
@@ -213,22 +160,17 @@ public class ArcOld{
                 return "[lightgray]x[white]" + Strings.autoFixed(s * 0.1f, 1) + "倍";
             });
 
-            c.addCategory("personalized");
-            c.checkPref("menuFloatText", true);
-            c.checkPref("colorizedContent", false);
-            c.textPref("arcBackgroundPath", "");
-
-            c.addCategory("developerMode");
-            c.checkPref("rotateCanvas", false);
-            c.checkPref("limitupdate", false, v -> {
-                if(!v) return;
-                settings.put("limitupdate", false);
-                ui.showConfirm("确认开启限制更新", "此功能可以大幅提升fps，但会导致视角外的一切停止更新\n在服务器里会造成不同步\n强烈不建议在单人开启\n\n[darkgray]在帧数和体验里二选一", () -> {
-                    settings.put("limitupdate", true);
-                });
-            });
-            c.sliderPref("limitdst", 10, 0, 100, 1, s -> s + "格");
-            c.checkPref("developMode", false);
+            c.addCategory("arcWeakCheat");
+            c.checkPref("save_more_map", false);
+            c.checkPref("forceIgnoreAttack", false);
+            c.checkPref("allUnlocked", false);
+            c.checkPref("worldCreator", false);
+            c.checkPref("overrideSkipWave", false);
+            c.checkPref("forceConfigInventory", false);
+            c.addCategory("arcStrongCheat");
+            c.checkPref("showOtherTeamResource", false);
+            c.checkPref("showOtherTeamState", false);
+            c.checkPref("playerNeedShooting", false);
         }));
     }
 
diff --git a/core/src/mindustryX/features/Settings.java b/core/src/mindustryX/features/Settings.java
index 62d10f76d6d4fc685a54523e7a21218d892b0977..a8ae66b63ff483862fc51b2f38422315be275562 100644
--- a/core/src/mindustryX/features/Settings.java
+++ b/core/src/mindustryX/features/Settings.java
@@ -9,7 +9,8 @@ import mindustry.game.EventType.*;
 import mindustry.gen.*;
 import mindustry.ui.dialogs.SettingsMenuDialog.*;
 
-import static mindustry.Vars.maxSchematicSize;
+import static arc.Core.settings;
+import static mindustry.Vars.*;
 
 public class Settings{
     public static class LazySettingsCategory extends SettingsCategory{
@@ -31,14 +32,34 @@ public class Settings{
         categories.add(new LazySettingsCategory("@settings.category.mindustryX", () -> Icon.box, (c) -> {
             c.checkPref("showUpdateDialog", true);
             c.checkPref("githubMirror", false);
+            c.checkPref("replayRecord", false);
 
-            c.addCategory("gameSettings");
+            c.addCategory("gameUI");
+            c.checkPref("menuFloatText", true);
             c.checkPref("deadOverlay", false);
             c.checkPref("invertMapClick", false);
-
-            c.addCategory("arcReWork");
-            c.checkPref("replayRecord", false);
-            c.checkPref("menuFloatText", true);
+            c.checkPref("arcSpecificTable", true);
+            c.checkPref("logicSupport", true);
+            c.checkPref("powerStatistic", true);
+            c.checkPref("showQuickToolTable", true);
+            c.sliderPref("AuxiliaryTable", 0, 0, 3, 1, s -> switch(s){
+                case 0 -> "关闭";
+                case 1 -> "左上-右";
+                case 2 -> "左上-下";
+                case 3 -> "右上-下";
+                default -> "";
+            });
+            c.sliderPref("arccoreitems", 3, 0, 3, 1, s -> switch(s){
+                case 0 -> "不显示";
+                case 1 -> "资源状态";
+                case 2 -> "兵种状态";
+                default -> "显示资源和兵种";
+            });
+            c.sliderPref("arcCoreItemsCol", 5, 4, 15, 1, i -> i + "列");
+            c.sliderPref("itemSelectionHeight", 4, 4, 12, i -> i + "行");
+            c.sliderPref("itemSelectionWidth", 4, 4, 12, i -> i + "列");
+            c.sliderPref("blockInventoryWidth", 3, 3, 16, i -> i + "");
+            c.sliderPref("editorBrush", 4, 3, 12, i -> i + "");
             c.checkPref("researchViewer", false);
             c.sliderPref("minimapSize", 140, 40, 400, 10, i -> i + "");
             c.sliderPref("maxSchematicSize", 64, 64, 257, 1, v -> {
@@ -49,8 +70,13 @@ public class Settings{
                 var v = Core.settings.getInt("maxSchematicSize");
                 maxSchematicSize = v == 257 ? Integer.MAX_VALUE : v;
             }
+            c.checkPref("colorizedContent", false);
+            c.textPref("arcBackgroundPath", "");
+            c.checkPref("autoSelSchematic", false);
+            c.checkPref("arcCommandTable", true);
 
             c.addCategory("blockSettings");
+            c.checkPref("rotateCanvas", false);
             c.checkPref("staticShieldsBorder", false);
             c.checkPref("arcTurretPlaceCheck", false);
             c.checkPref("arcchoiceuiIcon", false);
@@ -69,11 +95,20 @@ public class Settings{
             c.checkPref("showMineBeam".toLowerCase(), true);
             c.checkPref("noPlayerHitBox", false);
             c.checkPref("payloadpreview", true);
+            c.checkPref("unithitbox", false);
 
             c.addCategory("developerMode");
             c.checkPref("renderMerge", true);
             c.checkPref("renderSort", false);
             c.checkPref("reliableSync", false);
+            c.checkPref("limitupdate", false, v -> {
+                if(!v) return;
+                settings.put("limitupdate", false);
+                ui.showConfirm("确认开启限制更新", "此功能可以大幅减少LG开销，但会导致视角外的一切停止更新\n强烈不建议在单人开启，在服务器里会造成不同步", () -> {
+                    settings.put("limitupdate", true);
+                });
+            });
+            c.sliderPref("limitdst", 10, 0, 100, 1, s -> s + "格");
         }));
         ArcOld.init(categories);
         Events.on(ClientLoadEvent.class, e -> {
diff --git a/core/src/mindustryX/features/ui/ArcWaveInfoDialog.java b/core/src/mindustryX/features/ui/ArcWaveInfoDialog.java
index 3d0fc7ec9d8b3f400cd4d9270aef4a03569ff1c2..cf2eeb14d6e15487c05df634e523b61201692726 100644
--- a/core/src/mindustryX/features/ui/ArcWaveInfoDialog.java
+++ b/core/src/mindustryX/features/ui/ArcWaveInfoDialog.java
@@ -576,8 +576,7 @@ public class ArcWaveInfoDialog extends BaseDialog{
         dialog.cont.pane(p -> {
             int i = 0;
             for(UnitType type : content.units()){
-                if(type.internal) continue;
-                if(type.isHidden() && !(Core.settings.getBool("developmode"))) continue;
+                if(type.internal||type.isHidden()) continue;
                 p.button(t -> {
                     t.left();
                     t.image(type.uiIcon).size(8 * 4).scaling(Scaling.fit).padRight(2f);
