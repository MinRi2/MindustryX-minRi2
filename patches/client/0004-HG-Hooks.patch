From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Wed, 3 Apr 2024 21:57:24 +0800
Subject: [PATCH] HG: Hooks

---
 core/src/mindustry/ClientLauncher.java          | 1 +
 core/src/mindustry/Vars.java                    | 1 +
 core/src/mindustry/core/NetClient.java          | 4 ++++
 server/src/mindustry/server/ServerLauncher.java | 1 +
 4 files changed, 7 insertions(+)

diff --git a/core/src/mindustry/ClientLauncher.java b/core/src/mindustry/ClientLauncher.java
index 3e2fbca7df76607c76f27133d60686e4d4833cb5..655d2b09e7cfc011efd194b2b65bc85584c8f7d8 100644
--- a/core/src/mindustry/ClientLauncher.java
+++ b/core/src/mindustry/ClientLauncher.java
@@ -176,6 +176,7 @@ public abstract class ClientLauncher extends ApplicationCore implements Platform
         add(ui = new UI());
         add(netServer = new NetServer());
         add(netClient = new NetClient());
+        add(new mindustryX.Hooks());
 
         assets.load(schematics);
 
diff --git a/core/src/mindustry/Vars.java b/core/src/mindustry/Vars.java
index b9330d11955f03f1c87563961ff02f17a720c0aa..39ba8ad8de2dbf6de6baac3cff94fb3c73b6b57f 100644
--- a/core/src/mindustry/Vars.java
+++ b/core/src/mindustry/Vars.java
@@ -274,6 +274,7 @@ public class Vars implements Loadable{
     }
 
     public static void init(){
+        mindustryX.Hooks.beforeInit();
         Groups.init();
 
         if(loadLocales){
diff --git a/core/src/mindustry/core/NetClient.java b/core/src/mindustry/core/NetClient.java
index aed03c684b1f88c15c3f90056ff9f73377d9f368..2d1f5fc5606f8239dff13363e1c855fae3a2a687 100644
--- a/core/src/mindustry/core/NetClient.java
+++ b/core/src/mindustry/core/NetClient.java
@@ -230,6 +230,8 @@ public class NetClient implements ApplicationListener{
 
     @Remote(targets = Loc.server, variants = Variant.both)
     public static void sendMessage(String message, @Nullable String unformatted, @Nullable Player playersender){
+        message = mindustryX.Hooks.onHandleSendMessage(message, playersender);
+        if(message == null) return;
         if(Vars.ui != null){
             Vars.ui.chatfrag.addMessage(message);
             Sounds.chatMessage.play();
@@ -247,6 +249,8 @@ public class NetClient implements ApplicationListener{
     //equivalent to above method but there's no sender and no console log
     @Remote(called = Loc.server, targets = Loc.server)
     public static void sendMessage(String message){
+        message = mindustryX.Hooks.onHandleSendMessage(message, null);
+        if(message == null) return;
         if(Vars.ui != null){
             Vars.ui.chatfrag.addMessage(message);
             Sounds.chatMessage.play();
diff --git a/server/src/mindustry/server/ServerLauncher.java b/server/src/mindustry/server/ServerLauncher.java
index d8737fc5e1f449c7b0d093e6c2de3b9722952481..0f23c39ad937d6ead6e3657eb57a0c725ec84b56 100644
--- a/server/src/mindustry/server/ServerLauncher.java
+++ b/server/src/mindustry/server/ServerLauncher.java
@@ -76,6 +76,7 @@ public class ServerLauncher implements ApplicationListener{
         Core.app.addListener(netServer = new NetServer());
         Core.app.addListener(new ServerControl(args));
         Core.app.addListener(new ApplicationListener(){public void update(){ asyncCore.end(); }});
+        Core.app.addListener(new mindustryX.Hooks());
 
         mods.eachClass(Mod::init);
 
