From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Sun, 3 Aug 2025 19:20:34 +0800
Subject: [PATCH] FC: allow to publish zip mod to steam

---
 core/src/mindustry/mod/Mods.java | 21 +++++++++++++--------
 1 file changed, 13 insertions(+), 8 deletions(-)

diff --git a/core/src/mindustry/mod/Mods.java b/core/src/mindustry/mod/Mods.java
index edcf254a1b7045f921598ba13d0aef31a710e2a8..76c63f447ae4498cd1d43dbfd5c69962c29a6fd5 100644
--- a/core/src/mindustry/mod/Mods.java
+++ b/core/src/mindustry/mod/Mods.java
@@ -1361,22 +1361,27 @@ public class Mods implements Loadable{
 
         @Override
         public Fi createSteamFolder(String id){
-            return file;
+            if(file.isDirectory()) return file;
+            Fi out = tmpDirectory.child("mod_" + name);
+            out.deleteDirectory();
+            root.copyFilesTo(out);
+            return out;
         }
 
         @Override
         public Fi createSteamPreview(String id){
-            return file.child("preview.png");
+            Fi fi = root.child("preview.png");
+            if(fi instanceof ZipFi src){
+                Fi out = tmpDirectory.child("mod_" + name + "_preview.png");
+                src.copyTo(out);
+                return out;
+            }
+            return fi;
         }
 
         @Override
         public boolean prePublish(){
-            if(!file.isDirectory()){
-                ui.showErrorMessage("@mod.folder.missing");
-                return false;
-            }
-
-            if(!file.child("preview.png").exists()){
+            if(!root.child("preview.png").exists()){
                 ui.showErrorMessage("@mod.preview.missing");
                 return false;
             }
