From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Sat, 3 Aug 2024 00:17:31 +0800
Subject: [PATCH] FC(LogicExt) invertMapClick

---
 core/src/mindustry/ui/Minimap.java                   | 8 ++++++--
 core/src/mindustry/ui/fragments/MinimapFragment.java | 5 +++--
 core/src/mindustryX/features/LogicExt.java           | 2 ++
 3 files changed, 11 insertions(+), 4 deletions(-)

diff --git a/core/src/mindustry/ui/Minimap.java b/core/src/mindustry/ui/Minimap.java
index 037dea9ae4e54db3661071cb388d3850f6a156c0..ad214460bb8458b1eb323c2d10d314fd6fec3522 100644
--- a/core/src/mindustry/ui/Minimap.java
+++ b/core/src/mindustry/ui/Minimap.java
@@ -9,11 +9,13 @@ import arc.scene.event.*;
 import arc.scene.ui.layout.*;
 import arc.util.*;
 import mindustry.gen.*;
+import mindustryX.features.*;
 
 import static mindustry.Vars.*;
 
 public class Minimap extends Table{
     private final Cell<?> mapCell;
+    private ClickListener listener,listener2;
 
     public Minimap(){
         background(Tex.pane);
@@ -22,7 +24,7 @@ public class Minimap extends Table{
 
         mapCell = add(new Element(){
             {
-                addListener(new ClickListener(KeyCode.mouseRight){
+                addListener(listener = new ClickListener(KeyCode.mouseRight){
                     @Override
                     public void clicked(InputEvent event, float cx, float cy){
                         var region = renderer.minimap.getRegion();
@@ -45,6 +47,8 @@ public class Minimap extends Table{
                 mapCell.size(size);
                 setSize(Scl.scl(size));
                 setPosition(Scl.scl(margin), Scl.scl(margin));
+                listener.setButton(LogicExt.invertMapClick ? KeyCode.mouseLeft : KeyCode.mouseRight);
+                listener2.setButton(LogicExt.invertMapClick ? KeyCode.mouseRight : KeyCode.mouseLeft);
 
                 super.act(delta);
             }
@@ -81,7 +85,7 @@ public class Minimap extends Table{
             }
         });
 
-        addListener(new ClickListener(){
+        addListener(listener2 = new ClickListener(){
             {
                 tapSquareSize = Scl.scl(11f);
             }
diff --git a/core/src/mindustry/ui/fragments/MinimapFragment.java b/core/src/mindustry/ui/fragments/MinimapFragment.java
index 2fe8df586eb0a3907334e45b1639b9534e4b292c..89e00d6356c65d1bff200857e3769583a78aa316 100644
--- a/core/src/mindustry/ui/fragments/MinimapFragment.java
+++ b/core/src/mindustry/ui/fragments/MinimapFragment.java
@@ -13,6 +13,7 @@ import arc.util.*;
 import mindustry.gen.*;
 import mindustry.input.*;
 import mindustry.ui.*;
+import mindustryX.features.*;
 
 import static mindustry.Vars.*;
 
@@ -82,7 +83,7 @@ public class MinimapFragment{
 
             @Override
             public void pan(InputEvent event, float x, float y, float deltaX, float deltaY){
-                if(event.keyCode != KeyCode.mouseRight){
+                if(event.keyCode !=(LogicExt.invertMapClick ? KeyCode.mouseLeft : KeyCode.mouseRight)){
                     panx += deltaX / zoom;
                     pany += deltaY / zoom;
                 }else{
@@ -93,7 +94,7 @@ public class MinimapFragment{
             @Override
             public void touchDown(InputEvent event, float x, float y, int pointer, KeyCode button){
                 super.touchDown(event, x, y, pointer, button);
-                if(button == KeyCode.mouseRight){
+                if(button == (LogicExt.invertMapClick ? KeyCode.mouseLeft : KeyCode.mouseRight)){
                     panTo(x, y);
                 }
             }
diff --git a/core/src/mindustryX/features/LogicExt.java b/core/src/mindustryX/features/LogicExt.java
index d148408a6bac91abe640a07fd06e81d4f8e35c64..00ef53c2c05761e9fd10861b825575f754762639 100644
--- a/core/src/mindustryX/features/LogicExt.java
+++ b/core/src/mindustryX/features/LogicExt.java
@@ -10,6 +10,7 @@ public class LogicExt{
     public static boolean worldCreator = false;
     public static boolean allUnlocked = false;
     public static boolean terrainSchematic = false;
+    public static boolean invertMapClick = false;
 
     public static void init(){
         Events.run(Trigger.update, () -> {
@@ -22,6 +23,7 @@ public class LogicExt{
             worldCreator = Core.settings.getBool("worldCreator");
             allUnlocked = Core.settings.getBool("allUnlocked");
             terrainSchematic = Core.settings.getBool("terrainSchematic");
+            invertMapClick = Core.settings.getBool("invertMapClick");
         });
     }
 }
\ No newline at end of file
